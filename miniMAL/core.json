["do",

["def", "_path", ["require", ["`", "path"]]],

["def", "_node_readline", ["require", [".", "_path", ["`", "resolve"],
                                            ["`", "."],
                                            ["`", "node_readline.js"]]]],

["def", "div", ["fn", ["a", "b"], ["parseInt", ["/", "a", "b"]]]],

["def", "time-ms", ["fn", [],
  [".", ["new", "Date"], ["`", "getTime"]]]],

["def", "_count", ["fn", ["a"],
  ["if", ["=", null, "a"],
    0,
    ["count", "a"]]]],

["def", "_nth", ["fn", ["seq", "idx"],
  ["if", [">=", "idx", ["count", "seq"]],
    ["throw", "nth: index out of range"],
    ["nth", "seq", "idx"]]]],

["def", "_first", ["fn", ["seq"],
  ["if", ["empty?", "seq"],
    null,
    ["first", "seq"]]]],

["def", "_apply", ["fn", ["f", "&", "args"],
  ["let", ["fn", ["if", ["malfunc?", "f"], ["get", "f", ["`", "fn"]], "f"],
           "fargs", ["concat", ["slice", "args", 0, ["-", ["count", "args"], 1]],
                               ["nth", "args", ["-", ["count", "args"], 1]]]],
    ["apply", "fn", "fargs"]]]],

["def", "_map", ["fn", ["f", "seq"],
  ["let", ["fn", ["if", ["malfunc?", "f"], ["get", "f", ["`", "fn"]], "f"]],
    ["map", "fn", "seq"]]]],

["def", "core-ns",
  ["hash-map",
   ["`", "="], "equal?",
   ["`", "throw"], "throw",

   ["`", "nil?"], "nil?",
   ["`", "true?"], "true?",
   ["`", "false?"], "false?",
   ["`", "symbol"], "symbol",
   ["`", "symbol?"], "symbol?",

   ["`", "pr-str"],  ["fn", ["&", "a"], ["pr-list", "a", true, ["`", " "]]],
   ["`", "str"],     ["fn", ["&", "a"], ["pr-list", "a", false, ["`", ""]]],
   ["`", "prn"],     ["fn", ["&", "a"],
                       ["do",
                         ["println", ["pr-list", "a", true, ["`", " "]]],
                         null]],
   ["`", "println"], ["fn", ["&", "a"],
                       ["do",
                         ["println", ["pr-list", "a", false, ["`", " "]]],
                         null]],
   ["`", "read-string"], "read-str",
   ["`", "readline"], ["fn", ["p"],
                        [".", "_node_readline", ["`", "readline"], "p"]],
   ["`", "slurp"], "slurp",

   ["`", "<"],  "<",
   ["`", "<="], "<=",
   ["`", ">"],  ">",
   ["`", ">="], ">=",
   ["`", "+"],  "+",
   ["`", "-"],  "-",
   ["`", "*"],  "*",
   ["`", "/"],  "div",
   ["`", "time-ms"], "time-ms",

   ["`", "list"],   "list",
   ["`", "list?"],  "list?",

   ["`", "cons"], "cons",
   ["`", "concat"], "concat",
   ["`", "nth"], "_nth",
   ["`", "first"], "_first",
   ["`", "rest"], ["fn", ["a"], ["rest", "a"]],
   ["`", "empty?"], "empty?",
   ["`", "count"],  "_count",
   ["`", "apply"],  "_apply",
   ["`", "map"],  "_map"]],

null]
